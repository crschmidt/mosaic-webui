<html>
 <head>
   <title>Home &#x2014; OpenAerialMap</title>
   <link rel="stylesheet" href="http://oam.osgeo.org/static/website.css" type="text/css" />
   <script src="http://oam.osgeo.org/static/ol/OpenLayers.js"></script>
   <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
   <script type="text/javascript" src="http://oam.osgeo.org/static/js/map.js"></script>
   <script type="text/javascript" src="http://oam.osgeo.org/static/js/jquery.inlineedit.js"></script>
   <script type="text/javascript" src="http://oam.osgeo.org/static/js/jquery.json-2.2.min.js"></script>
   <link type="text/css" href="http://oam.osgeo.org/static/jq/css/ui-lightness/jquery-ui-1.8.13.custom.css" rel="stylesheet" />   
   <script type="text/javascript" src="http://oam.osgeo.org/static/jq/jquery-ui-1.8.13.custom.min.js"></script>
   
<script>
function createMap(url, div){
    var map = new OpenLayers.Map( 'map', {displayProjection: new OpenLayers.Projection("EPSG:4326")} );
    var layer = new OpenLayers.Layer.OSM("OSM");
    map.addLayer(layer);
    layer = new OpenLayers.Layer.Vector("", {
        strategies: [new OpenLayers.Strategy.BBOX({resFactor: 1.1,ratio:1.0})],
        protocol: new OpenLayers.Protocol.HTTP({
           url: url,
           format: new OAMFormat()
        }),
         styleMap: new OpenLayers.StyleMap({'strokeColor': '#000000', 'strokeWidth': 2, fillOpacity: 0}),
        'renderers': ['Canvas', 'VML']
        });
    map.addLayer(layer);
    layer.events.register("loadend", layer, function() {
        if (map.getCenter().lat == 0 && map.getCenter().lon == 0) {
          layer.map.zoomToExtent(layer.getDataExtent());
        }
    });
//    map.addControl(new OpenLayers.Control.Permalink());

    if (!map.getCenter()) {
        map.zoomToMaxExtent();
    } else {
        // kick the bbox strategy
        map.setCenter();
    }
    return map;
}

function handleOAMData(request) {
    var f=  new OAMFormat();
    var data = f.read(request.responseText);
    alert(data.length + " features");
}

function boundsReceived(bounds) {
    var ll = map.getLonLatFromPixel(new OpenLayers.Pixel(bounds.left, bounds.bottom)).transform(new OpenLayers.Projection("EPSG:900913"), new OpenLayers.Projection("EPSG:4326")); 
    var ur = map.getLonLatFromPixel(new OpenLayers.Pixel(bounds.right, bounds.top)).transform(new OpenLayers.Projection("EPSG:900913"), new OpenLayers.Projection("EPSG:4326")); 
    var url = "http://oam.osgeo.org/api/image/?bbox=" + ll.toShortString()+","+ur.toShortString();
    new OpenLayers.Request.GET({
        url: url,
        callback: handleOAMData
    });
}

function start() { 
    map = createMap("http://oam.osgeo.org/api/image/?limit=250", document.getElementById("map") ); 
    control = new OpenLayers.Control();
    OpenLayers.Util.extend(control, {
        draw: function () {
            // this Handler.Box will intercept the shift-mousedown
            // before Control.MouseDefault gets to see it
            this.handler = new OpenLayers.Handler.Box( control,
                {"done": this.notice},
                {keyMask: OpenLayers.Handler.MOD_SHIFT});
        },

        notice: function (bounds) {
            boundsReceived(bounds);
        }
    });
    map.addControl(control);
}


</script>

 </head>
 <body  onload="start();">
 <div id="header">
   <h1><a href="/">OpenAerialMap</a></h1>
 </div>
 <div id="mainnav" class="nav">
 </div>
 <div id="main">
 
<div id="map" style="width: 99%; height: 80%"></div>
</body></html>

